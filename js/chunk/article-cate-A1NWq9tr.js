import{b as p,q as f,j as e,t as j,v as y,k as T,A as E,w as b}from"../entry/index-Oeu-jSFw.js";import{g as k,p as C,e as F,d as S}from"./cate-api-8pQLXIi7.js";import{a as x,u as h}from"./hooks-CUpfB3N7.js";import"./index-s-kAbaNS.js";const R=()=>{const[a,t]=React.useState(!1),[n]=antd.Form.useForm(),s=p(),r=x("POST"),i=h("POST"),o=f(),d=()=>{t(!0)};React.useEffect(()=>{o&&r&&t(!1)},[r,o]);const c=()=>{n.validateFields().then(l=>{s(l,{method:"POST"})}).catch(l=>{})},u=()=>{t(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(antd.Button,{type:"primary",onClick:d,children:"添加分类"}),e.jsx(antd.Modal,{title:"Basic Modal",open:a,okText:"添加",cancelText:"取消",onOk:c,onCancel:u,afterClose:n.resetFields,okButtonProps:{loading:i&&{delay:200}},children:e.jsxs(antd.Form,{form:n,autoComplete:"off",style:{marginTop:25},children:[e.jsx(antd.Form.Item,{label:"文章类型",name:"cate_name",rules:[{required:!0,message:"请填写分类名称!"},{pattern:/^\S{1,10}$/,message:"分类名称必须是1-10位的非空字符!"}],children:e.jsx(antd.Input,{})}),e.jsx(antd.Form.Item,{label:"文章别名",name:"cate_alias",rules:[{required:!0,message:"请填写分类别名!"},{pattern:/^[0-9a-zA-Z]{1,15}$/,message:"分类别名必须是1-15位的字母数字!"}],children:e.jsx(antd.Input,{})})]})})]})},O=({id:a})=>{const[t,n]=React.useState(!1),s=p(),r=h("DELETE"),i=x("DELETE"),o=f();React.useEffect(()=>{o&&i&&n(!1)},[o,i]);const d=()=>{if(a===1||a===2)return antd.message.error("管理员不允许删除此分类！");s({id:a},{method:"DELETE"})},c=()=>{n(!1)},u=(g,m)=>{(m==null?void 0:m.currentTarget.dataset.type)!=="btn-ok"&&!g&&n(!1)},l=()=>{n(!0)};return e.jsx(antd.Popconfirm,{open:t,title:"操作提示",description:"您确定删除此文章分类吗？",okText:"确定",cancelText:"取消",onCancel:c,onConfirm:d,onOpenChange:u,okButtonProps:{loading:r&&{delay:200},"data-type":"btn-ok"},children:e.jsx(antd.Button,{type:"link",size:"small",onClick:l,children:"删除"})})},I=({cate:a})=>{const[t]=antd.Form.useForm(),[n,s]=React.useState(!1),r=p(),i=h("PUT"),o=x("PUT"),d=f();React.useEffect(()=>{o&&d&&s(!1)},[o,d]);const c=()=>{if(a.id===1||a.id===2)return antd.message.error("管理员不允许修改此数据！");t.setFieldsValue(a),s(!0)},u=()=>{t.validateFields().then(l=>{r(l,{method:"PUT"})}).catch(l=>{})};return e.jsxs(e.Fragment,{children:[e.jsx(antd.Button,{type:"link",size:"small",onClick:c,children:"修改"}),e.jsx(antd.Modal,{title:"修改文章分类",open:n,okText:"保存",cancelText:"取消",onOk:u,onCancel:()=>s(!1),afterClose:()=>t.resetFields(),okButtonProps:{loading:i&&{delay:200}},children:e.jsxs(antd.Form,{form:t,autoComplete:"off",style:{marginTop:25},children:[e.jsx(antd.Form.Item,{hidden:!0,name:"id",children:e.jsx(antd.Input,{readOnly:!0})}),e.jsx(antd.Form.Item,{label:"文章类型",name:"cate_name",rules:[{required:!0,message:"请填写分类名称!"},{pattern:/^\S{1,10}$/,message:"分类名称必须是1-10位的非空字符!"}],children:e.jsx(antd.Input,{})}),e.jsx(antd.Form.Item,{label:"文章别名",name:"cate_alias",rules:[{required:!0,message:"请填写分类别名!"},{pattern:/^[0-9a-zA-Z]{1,15}$/,message:"分类别名必须是1-15位的字母数字!"}],children:e.jsx(antd.Input,{})})]})})]})},D=()=>{const a=j(),[t,n]=React.useState(!1),s=y(),r=()=>{a.revalidate(),n(!0)};return React.useEffect(()=>{s&&n(!1)},[s]),e.jsx(antd.Spin,{spinning:t,children:e.jsx(antd.Result,{status:"warning",title:"数据加载失败，请稍后再试！",extra:e.jsx(antd.Button,{type:"primary",onClick:r,children:"重新加载"})})})},A=[{title:"序号",render:(a,t,n)=>n+1},{title:"分类名称",dataIndex:"cate_name"},{title:"分类别名",dataIndex:"cate_alias"},{title:"操作",render:(a,t)=>e.jsxs(antd.Space,{direction:"horizontal",children:[e.jsx(I,{cate:t}),e.jsx(O,{id:t.id})]})}],M=()=>{const a=T();return e.jsx(React.Suspense,{fallback:e.jsx(antd.Table,{loading:!0}),children:e.jsx(E,{resolve:a.result,errorElement:e.jsx(D,{}),children:t=>e.jsxs(antd.Space,{direction:"vertical",style:{display:"flex"},children:[e.jsx(R,{}),e.jsx(antd.Table,{dataSource:t.data,columns:A,size:"middle",rowKey:"id",pagination:!1,bordered:!0})]})})})},L=async()=>{const a=k();return b({result:a})},z=async({request:a})=>{const t=await a.formData(),n=a.method.toUpperCase();if(n==="POST"){try{await C(t)}catch{return null}antd.message.success("添加成功")}else if(n==="PUT"){try{await F(t)}catch{return null}antd.message.success("修改成功")}else if(n==="DELETE"){try{await S(t)}catch{return null}antd.message.success("删除成功")}return!0};export{z as action,M as default,L as loader};
