import{c as n,b as x,j as e,B as l}from"../entry/index-HYVjuyXu.js";import{u as g,s as j}from"./user-store-uoBPJTvm.js";import{u as b}from"./user-api-kpygNglZ.js";import{u as C}from"./hooks-6wdiGh58.js";import{S as m}from"./index-FvAIaAj1.js";import{A as d}from"./index-FIXWjQ-h.js";import{s as w}from"./index-Ofe16QpN.js";import"./index-qWcwa-Qk.js";const q=()=>{const r=g(j),s=n.useRef(null),[t,p]=n.useState(""),f=n.useMemo(()=>!t||t===r,[t,r]),h=x(),c=C("PATCH"),u=()=>{var a;(a=s.current)==null||a.click()},v=a=>{const o=a.currentTarget.files;if(!o||o.length===0)return;const i=new FileReader;i.readAsDataURL(o[0]),i.onload=()=>{i.result&&p(i.result)}},A=()=>{c||h({avatar:t},{method:"PATCH"})};return e.jsxs(m,{direction:"vertical",children:[t||r?e.jsx(d,{src:t||r,size:300,shape:"square"}):e.jsx(d,{size:300,shape:"square",onClick:u,children:"请选择头像"}),e.jsxs(m,{direction:"horizontal",children:[e.jsx(l,{onClick:u,children:"选择头像"}),e.jsx(l,{type:"primary",disabled:f,onClick:A,loading:c&&{delay:200},children:"保存头像"}),e.jsx("input",{type:"file",accept:"image/*",ref:s,onChange:v,hidden:!0})]})]})},B=async({request:r})=>{const s=await r.formData();try{await b(s)}catch{return null}return w.success("头像更新成功"),null};export{B as action,q as default};
