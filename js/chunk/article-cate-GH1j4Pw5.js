import{c as o,b as g,W as y,j as e,B as h,X as O,Y as D,Z as P,z as A,D as F,$ as I}from"../entry/index-HYVjuyXu.js";import{g as M,p as _,e as v,d as w}from"./cate-api-uY0erO4i.js";import{a as T,u as E}from"./hooks-6wdiGh58.js";import{F as n,I as f}from"./index-vkfpJKNu.js";import{M as C}from"./index-v8syB34c.js";import{P as B}from"./index-yUluXcFg.js";import{s as x}from"./index-Ofe16QpN.js";import{S as L}from"./index-U1XM-2_3.js";import{T as b}from"./Table-t7KwBjsN.js";import{S as k}from"./index-FvAIaAj1.js";import"./pickAttrs-XFrlQ5-n.js";import"./DownOutlined-Lu0pb220.js";import"./collapse-as1LdTNY.js";import"./EyeOutlined-9LXoceyI.js";import"./index-rOXd1mbK.js";import"./LeftOutlined-_FssBbef.js";import"./index-qWcwa-Qk.js";import"./addEventListener-ZIkeGcMV.js";const z=()=>{const[s,t]=o.useState(!1),[a]=n.useForm(),r=g(),i=T("POST"),d=E("POST"),l=y(),m=()=>{t(!0)};o.useEffect(()=>{l&&i&&t(!1)},[i,l]);const u=()=>{a.validateFields().then(c=>{r(c,{method:"POST"})}).catch(c=>{})},p=()=>{t(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(h,{type:"primary",onClick:m,children:"添加分类"}),e.jsx(C,{title:"Basic Modal",open:s,okText:"添加",cancelText:"取消",onOk:u,onCancel:p,afterClose:a.resetFields,okButtonProps:{loading:d&&{delay:200}},children:e.jsxs(n,{form:a,autoComplete:"off",style:{marginTop:25},children:[e.jsx(n.Item,{label:"文章类型",name:"cate_name",rules:[{required:!0,message:"请填写分类名称!"},{pattern:/^\S{1,10}$/,message:"分类名称必须是1-10位的非空字符!"}],children:e.jsx(f,{})}),e.jsx(n.Item,{label:"文章别名",name:"cate_alias",rules:[{required:!0,message:"请填写分类别名!"},{pattern:/^[0-9a-zA-Z]{1,15}$/,message:"分类别名必须是1-15位的字母数字!"}],children:e.jsx(f,{})})]})})]})},R=({id:s})=>{const[t,a]=o.useState(!1),r=g(),i=E("DELETE"),d=T("DELETE"),l=y();o.useEffect(()=>{l&&d&&a(!1)},[l,d]);const m=()=>{if(s===1||s===2)return x.error("管理员不允许删除此分类！");r({id:s},{method:"DELETE"})},u=()=>{a(!1)},p=(S,j)=>{(j==null?void 0:j.currentTarget.dataset.type)!=="btn-ok"&&!S&&a(!1)},c=()=>{a(!0)};return e.jsx(B,{open:t,title:"操作提示",description:"您确定删除此文章分类吗？",okText:"确定",cancelText:"取消",onCancel:u,onConfirm:m,onOpenChange:p,okButtonProps:{loading:i&&{delay:200},"data-type":"btn-ok"},children:e.jsx(h,{type:"link",size:"small",onClick:c,children:"删除"})})},U=({cate:s})=>{const[t]=n.useForm(),[a,r]=o.useState(!1),i=g(),d=E("PUT"),l=T("PUT"),m=y();o.useEffect(()=>{l&&m&&r(!1)},[l,m]);const u=()=>{if(s.id===1||s.id===2)return x.error("管理员不允许修改此数据！");t.setFieldsValue(s),r(!0)},p=()=>{t.validateFields().then(c=>{i(c,{method:"PUT"})}).catch(c=>{})};return e.jsxs(e.Fragment,{children:[e.jsx(h,{type:"link",size:"small",onClick:u,children:"修改"}),e.jsx(C,{title:"修改文章分类",open:a,okText:"保存",cancelText:"取消",onOk:p,onCancel:()=>r(!1),afterClose:()=>t.resetFields(),okButtonProps:{loading:d&&{delay:200}},children:e.jsxs(n,{form:t,autoComplete:"off",style:{marginTop:25},children:[e.jsx(n.Item,{hidden:!0,name:"id",children:e.jsx(f,{readOnly:!0})}),e.jsx(n.Item,{label:"文章类型",name:"cate_name",rules:[{required:!0,message:"请填写分类名称!"},{pattern:/^\S{1,10}$/,message:"分类名称必须是1-10位的非空字符!"}],children:e.jsx(f,{})}),e.jsx(n.Item,{label:"文章别名",name:"cate_alias",rules:[{required:!0,message:"请填写分类别名!"},{pattern:/^[0-9a-zA-Z]{1,15}$/,message:"分类别名必须是1-15位的字母数字!"}],children:e.jsx(f,{})})]})})]})},$=()=>{const s=O(),[t,a]=o.useState(!1),r=D(),i=()=>{s.revalidate(),a(!0)};return o.useEffect(()=>{r&&a(!1)},[r]),e.jsx(L,{spinning:t,children:e.jsx(P,{status:"warning",title:"数据加载失败，请稍后再试！",extra:e.jsx(h,{type:"primary",onClick:i,children:"重新加载"})})})},q=[{title:"序号",render:(s,t,a)=>a+1},{title:"分类名称",dataIndex:"cate_name"},{title:"分类别名",dataIndex:"cate_alias"},{title:"操作",render:(s,t)=>e.jsxs(k,{direction:"horizontal",children:[e.jsx(U,{cate:t}),e.jsx(R,{id:t.id})]})}],le=()=>{const s=A();return e.jsx(o.Suspense,{fallback:e.jsx(b,{loading:!0}),children:e.jsx(F,{resolve:s.result,errorElement:e.jsx($,{}),children:t=>e.jsxs(k,{direction:"vertical",style:{display:"flex"},children:[e.jsx(z,{}),e.jsx(b,{dataSource:t.data,columns:q,size:"middle",rowKey:"id",pagination:!1,bordered:!0})]})})})},ce=async()=>{const s=M();return I({result:s})},de=async({request:s})=>{const t=await s.formData(),a=s.method.toUpperCase();if(a==="POST"){try{await _(t)}catch{return null}x.success("添加成功")}else if(a==="PUT"){try{await v(t)}catch{return null}x.success("修改成功")}else if(a==="DELETE"){try{await w(t)}catch{return null}x.success("删除成功")}return!0};export{de as action,le as default,ce as loader};
