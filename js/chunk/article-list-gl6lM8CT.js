import{u as h,k as l,c as x,j as n,i as y,d as f,b as L,q as v,B as _,A as w,w as A,r as B}from"../entry/index-z2ldqZB7.js";import{b as E,d as R}from"./article-api-jngkzcRB.js";import{g as z}from"./cate-api-8TfO8f7V.js";import{u as C,a as F}from"./hooks-B1h-UHW-.js";import"./index-IOKQZmPc.js";const T=()=>{const[,a]=h(),[e]=antd.Form.useForm(),t=l(),[s]=x();React.useEffect(()=>{e.setFieldsValue({cate_id:t==null?void 0:t.queryParam.cate_id,state:t==null?void 0:t.queryParam.state})},[e,t==null?void 0:t.queryParam]);const r=i=>{const c={...t==null?void 0:t.queryParam,...i,pagenum:1};a(c)};return n.jsxs(antd.Form,{form:e,layout:"inline",onFinish:r,children:[n.jsx(antd.Form.Item,{name:"cate_id",label:"分类",children:n.jsx(antd.Select,{placeholder:"请选择",style:{width:180},options:s.data?[{cate_name:"请选择",id:""},...s.data]:[],fieldNames:{label:"cate_name",value:"id"}})}),n.jsx(antd.Form.Item,{name:"state",label:"状态",children:n.jsx(antd.Select,{placeholder:"请选择",options:[{label:"请选择",value:""},{label:"已发布",value:"已发布"},{label:"草稿",value:"草稿"}],style:{width:180}})}),n.jsx(antd.Form.Item,{children:n.jsx(antd.Button,{type:"primary",htmlType:"submit",children:"搜索"})}),n.jsx(antd.Form.Item,{children:n.jsx(antd.Button,{type:"default",onClick:()=>a(),children:"重置"})})]})},q=({id:a})=>{const e=y(),t=f();return n.jsx(antd.Button,{type:"link",size:"small",onClick:()=>e("/art-edit/"+a,{state:t.search}),children:"编辑"})},I=({id:a})=>{const[e,t]=React.useState(!1),s=L(),r=f(),i=C("DELETE",r.pathname+r.search),c=F("DELETE",r.pathname+r.search),m=v(),p=l(),[,g]=x(),{queryParam:d}=p,j=g.data||[],b=g.total;React.useEffect(()=>{m&&c&&t(!1)},[m,c]);const P=()=>{let o=!1;p&&(o=j.length===1&&d.pagenum!==1&&d.pagenum===Math.ceil(b/d.pagesize)),s({id:a,needBack:o},{method:"DELETE"})},k=(o,u)=>{const S=u==null?void 0:u.currentTarget.dataset.type;!o&&S!=="btn-ok"&&t(!1)};return n.jsx(antd.Popconfirm,{open:e,title:"操作提示",description:"您确认删除此文章吗？",okText:"确认",cancelText:"取消",onConfirm:P,onCancel:()=>t(!1),onOpenChange:k,okButtonProps:{"data-type":"btn-ok",loading:i&&{delay:200}},children:n.jsx(antd.Button,{type:"link",size:"small",onClick:()=>t(!0),children:"删除"})})},N=({index:a})=>{const e=l();return e&&(e.queryParam.pagenum-1)*e.queryParam.pagesize+a+1},O=[{title:"序号",render:(a,e,t)=>n.jsx(N,{index:t})},{title:"标题",dataIndex:"title"},{title:"分类",dataIndex:"cate_name"},{title:"发布时间",dataIndex:"pub_date",render:a=>dayjs(a).format("YYYY-MM-DD HH:mm:ss")},{title:"状态",dataIndex:"state"},{title:"操作",render:(a,e)=>n.jsxs(n.Fragment,{children:[n.jsx(q,{id:e.id}),n.jsx(I,{id:e.id})]})}],M=a=>{const[,e]=h(),t=React.useMemo(()=>({total:a.total,current:a.pagenum,pageSize:a.pagesize,pageSizeOptions:[2,3,5,10,20],showSizeChanger:!0,showQuickJumper:!0,showTotal(s){return`共${s}条数据`},onChange(s,r){e({pagenum:s,pagesize:r,state:a.state,cate_id:a.cate_id})}}),[a,e]);return n.jsx(antd.Table,{...a,columns:O,pagination:t})},J=()=>{var r;const a=y(),e=l(),t=_(),s=React.useMemo(()=>{var i;return((i=t.location)==null?void 0:i.pathname)==="/art-list"&&t.state==="loading"},[(r=t.location)==null?void 0:r.pathname,t.state]);return n.jsx(React.Suspense,{fallback:n.jsx(antd.Skeleton,{active:!0}),children:n.jsx(w,{resolve:e.result,children:i=>{const c=i[1];return n.jsx(antd.Spin,{spinning:s,children:n.jsxs(antd.Space,{direction:"vertical",style:{display:"flex"},children:[n.jsxs(antd.Flex,{justify:"space-between",children:[n.jsx(T,{}),n.jsx(antd.Button,{type:"primary",onClick:()=>a("/art-add"),children:"添加文章"})]}),n.jsx(M,{rowKey:"id",dataSource:c.data,size:"middle",bordered:!0,total:c.total,...e==null?void 0:e.queryParam})]})})}})})},K=async({request:a})=>{const e=new URL(a.url).searchParams,t={pagenum:Number(e.get("pagenum"))||1,pagesize:Number(e.get("pagesize"))||10,cate_id:Number(e.get("cate_id"))||"",state:e.get("state")||""},s=Promise.all([z(),E(t)]);return A({result:s,queryParam:t})},Q=async({request:a})=>{const e=await a.formData();try{if(await R(e),antd.message.success("删除成功"),e.get("needBack")==="true"){const s=new URL(a.url),r=Number(s.searchParams.get("pagenum"))-1;return s.searchParams.set("pagenum",String(r)),B(s.toString())}return!0}catch{return null}};export{Q as action,J as default,K as loader};
